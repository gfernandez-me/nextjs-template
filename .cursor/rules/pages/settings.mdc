---
alwaysApply: true
---

# Scoring Settings and Thresholds

## Overview

- New `Settings` table stores configurable scoring:
  - `fScoreIncludeMainStat` (boolean)
  - `fScoreSubstatWeights` (JSON map of substat label → weight)
  - `fScoreMainStatWeights` (JSON map of main stat type enum → weight)
  - `substatThresholds` (JSON map of substat label → { plus15: [t1,t2,t3,t4] }) used for badge coloring

## Defaults

- Substat weights: Speed 2.0, Crit % 1.5, Crit Dmg % 1.3, Attack % 1.2, Defense % 0.8, Health % 0.8, Effectiveness % 0.7, Effect Resist % 0.6, Attack 0.3, Defense 0.2, Health 0.2
- Main stat weights: att 0, def 0, max_hp 0, att_rate 0.5, def_rate 0.3, max_hp_rate 0.3, cri 0.6, cri_dmg 0.6, speed 1.0, acc 0.4, res 0.4
- Thresholds (+15): Speed [4,8,12,18], Crit % [4,8,12,16], Crit Dmg % [4,8,12,20], Attack %/Defense %/Health % [4,8,12,16], Effectiveness %/Effect Resist % [4,8,12,16], Attack [20,40,60,90], Defense [10,20,30,45], Health [50,100,150,220]

## API

- GET/POST `/api/settings`: read and save settings
- POST `/api/settings/recalculate`: recompute fScore of all gears using current settings

## UI

- `/settings` page allows editing weights and thresholds and triggers recalculation
- Upload page shows formulas dynamically based on saved settings

## Scoring

- fScore: Σ(substatValue × subWeight) [+ mainStatValue × mainWeight if enabled]
- score: fixed weighted sum of substats only (unchanged)
